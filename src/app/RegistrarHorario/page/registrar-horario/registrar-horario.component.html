<div class="horario-container">
  <mat-card class="horario-card">
    <mat-card-header>
      <mat-card-title class="card-title">
        <mat-icon>schedule</mat-icon>
        {{ isEdit ? 'Editar Horario' : 'Registrar Horario' }}
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="formGroup" class="horario-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Fecha y Hora</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="fechaHora" 
                   [value]="getDisplayDateTime()"
                   (dateChange)="onDateChange($event)"
                   [class.mat-input-invalid]="formGroup.get('fechaHora')?.invalid && formGroup.get('fechaHora')?.touched">
            <mat-datepicker-toggle matSuffix [for]="picker">
              <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-hint>Selecciona la fecha y hora del horario</mat-hint>
            <mat-error *ngIf="formGroup.get('fechaHora')?.invalid && formGroup.get('fechaHora')?.touched">
              La fecha y hora son obligatorias
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Hora</mat-label>
            <input matInput type="time" formControlName="hora" 
                   (change)="onTimeChange($event)"
                   [class.mat-input-invalid]="formGroup.get('fechaHora')?.invalid && formGroup.get('fechaHora')?.touched">
            <mat-error *ngIf="formGroup.get('fechaHora')?.invalid && formGroup.get('fechaHora')?.touched">
              La hora es obligatoria
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Turno</mat-label>
            <mat-select formControlName="turno">
              <mat-option value="DIA">
                <mat-icon>wb_sunny</mat-icon>
                DIA
              </mat-option>
              <mat-option value="NOCHE">
                <mat-icon>nightlight_round</mat-icon>
                Noche
              </mat-option>
            </mat-select>
            <mat-error *ngIf="formGroup.get('turno')?.invalid && formGroup.get('turno')?.touched">
              Debe seleccionar un turno
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Tipo de Horario</mat-label>
            <mat-select formControlName="horarios">
              <mat-option value="ENTRADA">
                <mat-icon>login</mat-icon>
                Entrada
              </mat-option>
              <mat-option value="SALIDA">
                <mat-icon>logout</mat-icon>
                Salida
              </mat-option>
              <mat-option value="EXTRA">
                <mat-icon>schedule</mat-icon>
                Extra
              </mat-option>
            </mat-select>
            <mat-error *ngIf="formGroup.get('horarios')?.invalid && formGroup.get('horarios')?.touched">
              Debe seleccionar un tipo de horario
            </mat-error>
          </mat-form-field>

          <div class="half-width">
            <app-buscador-persona
              [personaSeleccionada]="personaSeleccionada"
              [disabled]="!formEnabled"
              [placeholder]="'Seleccionar persona'"
              [showEmail]="true"
              (personaSeleccionadaChange)="onPersonaSeleccionada($event)">
            </app-buscador-persona>
            <mat-error *ngIf="formGroup.get('personaId')?.invalid && formGroup.get('personaId')?.touched">
              Debe seleccionar una persona
            </mat-error>
          </div>
        </div>
      </form>
    </mat-card-content>
    
    <mat-card-actions class="card-actions">
      <button mat-raised-button 
              color="accent" 
              (click)="nuevo()" 
              [disabled]="loading"
              class="action-button"
              aria-label="Crear nuevo horario">
        <mat-icon>add</mat-icon>
        Nuevo
      </button>
      
      <button mat-raised-button 
              color="primary" 
              (click)="guardar()" 
              [disabled]="formGroup.invalid || loading || !formEnabled"
              class="action-button"
              aria-label="Guardar horario">
        <mat-icon>save</mat-icon>
        <span *ngIf="loading">Guardando...</span>
        <span *ngIf="!loading">{{ isEdit ? 'Actualizar' : 'Guardar' }}</span>
        <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
      </button>
      
      <button mat-stroked-button 
              color="warn" 
              (click)="cancelar()" 
              [disabled]="!formEnabled"
              class="action-button"
              aria-label="Cancelar y limpiar formulario">
        <mat-icon>cancel</mat-icon>
        Cancelar
      </button>
    </mat-card-actions>
  </mat-card>
</div>
  