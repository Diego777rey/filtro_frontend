<div class="buscador-cliente-container">
  <!-- Barra de búsqueda -->
  <div class="search-bar-container">
    <div class="search-input-container">
      <input 
        type="text"
        class="search-input"
        [value]="getDisplayText()"
        [placeholder]="placeholder"
        [disabled]="disabled || loading"
        (click)="abrirModal()"
        readonly>
      <mat-spinner *ngIf="loading" diameter="16" class="loading-spinner"></mat-spinner>
    </div>
    
    <button 
      mat-raised-button 
      color="primary"
      class="search-button"
      (click)="abrirModal()"
      [disabled]="disabled || loading"
      matTooltip="Buscar cliente">
      <mat-icon>search</mat-icon>
    </button>
    
    <!-- Botón de limpiar selección -->
    <button mat-icon-button 
            *ngIf="clienteSeleccionado && !disabled"
            class="clear-button"
            (click)="limpiarSeleccion()"
            matTooltip="Limpiar selección">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>

<!-- Modal de búsqueda de clientes -->
<ng-template #modalTemplate>
  <div class="modal-content">
    <h2 mat-dialog-title>Seleccionar Cliente</h2>
    
    <mat-dialog-content class="modal-body">
      <!-- Formulario de filtros simplificado -->
      <div class="filters-section">
        <div class="filter-input-container">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Buscar por nombre, documento, email o teléfono</mat-label>
            <input matInput 
                   [formControl]="filtroControl"
                   placeholder="Escribe para filtrar...">
            <mat-icon matSuffix *ngIf="filtroBusqueda" (click)="limpiarFiltro()" class="clear-icon">close</mat-icon>
          </mat-form-field>
          
          <!-- Botón de recarga -->
          <button mat-icon-button 
                  (click)="cargarClientes()" 
                  [disabled]="loading"
                  matTooltip="Recargar clientes"
                  class="reload-button">
            <mat-icon>refresh</mat-icon>
          </button>
        </div>
      </div>
      
      <!-- Lista de clientes filtrados -->
      <div class="clientes-list" *ngIf="clientesFiltrados.length > 0; else noResults">
        <button mat-list-item 
                *ngFor="let cliente of clientesFiltrados; trackBy: trackByCliente"
                (click)="seleccionarCliente(cliente)"
                class="cliente-item"
                [class.selected]="esClienteSeleccionado(cliente)">
          
          <mat-icon matListItemIcon>person</mat-icon>
          
          <div class="cliente-info">
            <div matListItemTitle class="cliente-name">
              {{ cliente.persona.nombre }} {{ cliente.persona.apellido }}
            </div>
            <div matListItemLine class="cliente-documento">
              Documento: {{ cliente.persona.documento || 'No especificado' }}
            </div>
            <div matListItemLine *ngIf="showEmail && cliente.persona.email" class="cliente-email">
              {{ cliente.persona.email }}
            </div>
            <div matListItemLine *ngIf="showTelefono && cliente.persona.telefono" class="cliente-telefono">
              Tel: {{ cliente.persona.telefono }}
            </div>
          </div>
          
          <div class="cliente-action">
            <span class="action-text">Seleccionar</span>
            <mat-icon *ngIf="esClienteSeleccionado(cliente)" 
                      class="check-icon">check_circle</mat-icon>
          </div>
        </button>
      </div>
      
      <!-- Sin resultados -->
      <ng-template #noResults>
        <div class="no-results" *ngIf="!error">
          <mat-icon>person_off</mat-icon>
          <p>No se encontraron clientes</p>
          <small *ngIf="filtroBusqueda">Intenta con otros términos de búsqueda</small>
        </div>
      </ng-template>

      <!-- Error de carga -->
      <div class="error-results" *ngIf="error">
        <mat-icon>error_outline</mat-icon>
        <p>Error al cargar clientes</p>
        <small>{{ errorMessage }}</small>
        <button mat-stroked-button color="primary" (click)="cargarClientes()" class="retry-button">
          <mat-icon>refresh</mat-icon>
          Reintentar
        </button>
      </div>
      
      <!-- Estado de carga -->
      <div class="loading-results" *ngIf="loading">
        <mat-spinner diameter="24"></mat-spinner>
        <p>Cargando clientes...</p>
      </div>
    </mat-dialog-content>
    
    <mat-dialog-actions align="end">
      <button mat-stroked-button (click)="cerrarModal()">
        <mat-icon>close</mat-icon>
        Cancelar
      </button>
    </mat-dialog-actions>
  </div>
</ng-template>
