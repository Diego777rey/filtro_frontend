<div class="ventas-pendientes-container">
  <!-- Header -->
  <div class="header-section">
    <div class="header-content">
      <div class="header-actions">
        <button mat-icon-button (click)="volver()" class="back-button" matTooltip="Volver">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <button mat-icon-button (click)="refrescarVentasPendientes()" matTooltip="Refrescar lista" [disabled]="loading">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
      <div class="header-text">
        <h1>Ventas Pendientes de Aprobación</h1>
        <p class="subtitle">Ventas que requieren aprobación del cajero</p>
      </div>
    </div>
  </div>

  <!-- Barra de filtros -->
  <mat-card class="filters-card" *ngIf="!loading && dataSource.data.length > 0">
    <mat-card-content>
      <div class="filters-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar ventas...</mat-label>
          <input matInput (keyup)="aplicarFiltro($event)" placeholder="Buscar por cliente, vendedor, código...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        <button mat-stroked-button (click)="limpiarFiltros()" class="clear-filter-button">
          <mat-icon>clear</mat-icon>
          Limpiar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Tabla de ventas pendientes -->
  <mat-card class="table-card">
    <mat-card-content>
      <!-- Loading spinner -->
      <div class="loading-container" *ngIf="loading">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando ventas pendientes...</p>
      </div>

      <!-- Tabla -->
      <div class="table-container" *ngIf="!loading">
        <table mat-table [dataSource]="dataSource" class="ventas-table">
          
          <!-- Columna Cliente -->
          <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef>Cliente</th>
            <td mat-cell *matCellDef="let venta">
              <div *ngIf="venta.cliente" class="cliente-info">
                <mat-icon>person</mat-icon>
                <div>
                  <div class="nombre">{{ venta.cliente.nombre }} {{ venta.cliente.apellido }}</div>
                </div>
              </div>
              <span *ngIf="!venta.cliente" class="no-data">Sin cliente</span>
            </td>
          </ng-container>

          <!-- Columna Vendedor -->
          <ng-container matColumnDef="vendedor">
            <th mat-header-cell *matHeaderCellDef>Vendedor</th>
            <td mat-cell *matCellDef="let venta">
              <div *ngIf="venta.vendedor" class="vendedor-info">
                <mat-icon>store</mat-icon>
                <div>
                  <div class="nombre">{{ venta.vendedor.nombre }} {{ venta.vendedor.apellido }}</div>
                </div>
              </div>
              <span *ngIf="!venta.vendedor" class="no-data">Sin vendedor</span>
            </td>
          </ng-container>

          <!-- Columna Total -->
          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef>Total</th>
            <td mat-cell *matCellDef="let venta">
              <div class="total-info">
                <span class="amount">{{ formatCurrency(venta.total) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Items -->
          <ng-container matColumnDef="items">
            <th mat-header-cell *matHeaderCellDef>Items</th>
            <td mat-cell *matCellDef="let venta">
              <div class="items-info">
                <div class="items-count">{{ getTotalItems(venta.items) }} productos</div>
                <div class="items-detail" *ngIf="venta.items && venta.items.length > 0">
                  <div *ngFor="let item of venta.items.slice(0, 2)" class="item-row">
                    {{ item.cantidad }}x {{ item.producto.nombre }}
                  </div>
                  <div *ngIf="venta.items.length > 2" class="more-items">
                    +{{ venta.items.length - 2 }} más...
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Columna Estado -->
          <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef>Estado</th>
            <td mat-cell *matCellDef="let venta">
              <div class="estado-info" [ngClass]="getEstadoClass(venta)">
                <mat-icon>{{ getEstadoIcon(venta) }}</mat-icon>
                <span>{{ getEstadoText(venta) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Acciones -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let venta">
              <div class="actions-container" *ngIf="!venta.estado || venta.estado === 'pendiente'">
                <button 
                  mat-raised-button 
                  color="primary" 
                  (click)="aceptarVenta(venta.id!)"
                  [disabled]="loading"
                  class="accept-button">
                  <mat-icon>check_circle</mat-icon>
                  Aceptar
                </button>
                <button 
                  mat-raised-button 
                  color="warn" 
                  (click)="cancelarVenta(venta.id!)"
                  [disabled]="loading"
                  class="cancel-button">
                  <mat-icon>cancel</mat-icon>
                  Cancelar
                </button>
              </div>
              <div class="no-actions" *ngIf="venta.estado && venta.estado !== 'pendiente'">
                <span class="no-actions-text">Procesada</span>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="getRowClass(row)"></tr>
        </table>

        <!-- Mensaje cuando no hay datos -->
        <div class="no-data-message" *ngIf="dataSource.data.length === 0">
          <mat-icon>inbox</mat-icon>
          <p *ngIf="!dataSource.filter">No hay ventas pendientes de aprobación</p>
          <p *ngIf="dataSource.filter">No se encontraron ventas que coincidan con el filtro</p>
          <button mat-stroked-button (click)="limpiarFiltros()" *ngIf="dataSource.filter" class="clear-filter-btn">
            <mat-icon>clear</mat-icon>
            Limpiar filtro
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
