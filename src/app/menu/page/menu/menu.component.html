<mat-sidenav-container class="sidenav-container">

  <!-- Sidenav -->
  <mat-sidenav #drawer mode="side" class="sidenav" [class.collapsed]="isCollapsed" [opened]="true">
    <div class="brand" [class.collapsed]="isCollapsed">
      <div class="logo">
        <mat-icon class="brand-icon">person</mat-icon>
        <div class="user-name" *ngIf="!isCollapsed">{{ userFullName }}</div>
      </div>
    </div>

    <mat-nav-list class="nav-list" [class.collapsed]="isCollapsed">
      <mat-list-item *ngIf="isAdmin" 
                     class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Usuarios' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/usuario" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">people</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Usuarios</span>
      </mat-list-item>

      <!-- Menú desplegable de Funcionarios -->
      <mat-list-item 
        *ngIf="isAdmin" 
        (click)="toggleFuncionarios($event)" 
        class="nav-item expandable-item"
        [class.collapsed]="isCollapsed"
        [attr.data-tooltip]="isCollapsed ? 'Funcionarios' : null"
        role="button"
        [attr.aria-expanded]="isFuncionariosExpanded"
        [attr.aria-controls]="'funcionarios-submenu'"
        tabindex="0"
        [attr.aria-label]="'Funcionarios - ' + (isFuncionariosExpanded ? 'Contraer menú' : 'Expandir menú')"
        (keydown.enter)="toggleFuncionarios($event)"
        (keydown.space)="toggleFuncionarios($event)">
        <mat-icon class="nav-icon">business_center</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Funcionarios</span>
        <mat-icon 
          *ngIf="!isCollapsed"
          class="expand-icon" 
          [class.rotated]="isFuncionariosExpanded">expand_more</mat-icon>
      </mat-list-item>

      <!-- Sub-items del menú Funcionarios -->
      <nav 
        *ngIf="isFuncionariosExpanded && isAdmin && !isCollapsed" 
        id="funcionarios-submenu"
        class="sub-menu"
        role="menu"
        [attr.aria-label]="'Submenú de funcionarios'">
        <mat-list-item 
          *ngFor="let item of funcionariosSubMenu"
          class="sub-item"
          role="menuitem"
          [routerLink]="item.route"
          routerLinkActive="active"
          [attr.aria-label]="'Ir a ' + item.label">
          <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
          <span class="nav-text">
            {{ item.label }}
          </span>
        </mat-list-item>
      </nav>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Clientes' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/clientes" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">person</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Clientes</span>
      </mat-list-item>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Proveedores' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/proveedor" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">local_shipping</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Proveedores</span>
      </mat-list-item>

      <mat-list-item *ngIf="isAdmin" 
                     class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Categorías' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/categoria" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">category</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Categorías</span>
      </mat-list-item>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Productos' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/producto" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">inventory</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Productos</span>
      </mat-list-item>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Ventas' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/ventas" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">point_of_sale</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Ventas</span>
      </mat-list-item>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Factura' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/ventas" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">receipt</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Factura</span>
      </mat-list-item>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Inventario' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/ventas" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">warehouse</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Inventario</span>
      </mat-list-item>

      <mat-list-item class="nav-item" 
                     [class.collapsed]="isCollapsed"
                     [attr.data-tooltip]="isCollapsed ? 'Horarios' : null"
                     (mouseenter)="expandMenu()"
                     routerLink="/dashboard/ventas" 
                     routerLinkActive="active">
        <mat-icon class="nav-icon">schedule</mat-icon>
        <span class="nav-text" *ngIf="!isCollapsed">Horarios</span>
      </mat-list-item>

    </mat-nav-list>
  </mat-sidenav>

  <!-- Toolbar -->
  <mat-sidenav-content>
    <mat-toolbar class="top-toolbar">
      <button mat-icon-button (click)="toggleMenu()">
        <mat-icon>menu</mat-icon>
      </button>
      <mat-icon class="toolbar-icon">home</mat-icon>
      <span class="nav-text" routerLink="/dashboard/bienvenido" routerLinkActive="active">Inicio</span>

      <span class="toolbar-separator"></span>
      
      <mat-icon class="toolbar-icon">access_time</mat-icon>
      <span class="nav-text" routerLink="/dashboard/horario" routerLinkActive="active">Marcar Horario</span>
      <span class="toolbar-separator"></span>
      
      <mat-icon class="toolbar-icon">account_balance</mat-icon>
      <span class="nav-text" routerLink="/dashboard/caja" routerLinkActive="active">Caja</span>
      <span class="toolbar-separator"></span>

      <mat-icon class="toolbar-icon">swap_horiz</mat-icon>
      <span class="nav-text" routerLink="/dashboard/movimientos-caja" routerLinkActive="active">Movimientos de Caja</span>
      <span class="toolbar-separator"></span>
      <span class="toolbar-spacer"></span>

      <button mat-icon-button aria-label="download" matTooltip="Descargar">
        <mat-icon>download</mat-icon>
      </button>
      <button mat-icon-button aria-label="logout" (click)="logout()" matTooltip="Cerrar sesión">
        <mat-icon>logout</mat-icon>
      </button>
      <button mat-icon-button aria-label="user" (click)="abrirDialog()" 
              [matTooltip]="userTooltip"  
              [color]="userAvatarColor"
              class="user-avatar">
        <mat-icon [color]="userAvatarColor" class="user-avatar">{{ userAvatarIcon }}</mat-icon>
      </button>
    </mat-toolbar>
    
    <app-tab-container></app-tab-container>
    
    <router-outlet></router-outlet>
  </mat-sidenav-content>

</mat-sidenav-container>
